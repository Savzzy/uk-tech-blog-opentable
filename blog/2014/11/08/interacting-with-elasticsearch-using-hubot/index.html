<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="OpenTable"><link rel="icon" href="/favicon.png"><title>OpenTable Tech UK Blog</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="OpenTable Tech UK Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><script src="//fonts.otstatic.com/zys4lfz.js"></script><link rel="stylesheet" href="/css/highlight.css">
</head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">OpenTable Tech UK Blog</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/about/">About</a></li><li><a href="/archives/">Archive</a></li><li><a href="/blog/authors/">Authors</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/opentable.png" class="avatar-img"></a></div></div></div></nav><header class="header-section"><div class="intro-header no-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><h1>Interacting with ElasticSearch using Hubot</h1><p class="post-meta">Posted by <a href="/blog/authors/pstack.html">pstack</a>, 8 November 2014 · <a href="/blog/categories/Hubot/" class="tag post-meta">Hubot</a> · <a href="/blog/categories/Chatops/" class="tag post-meta">Chatops</a> · <a href="/blog/categories/ElasticSearch/" class="tag post-meta">ElasticSearch</a></p></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role="main" class="blog-post"><p>At OpenTable, we use a few <a href>ElasticSearch</a> clusters. Our aim was to be able to interact with our ElasticSearch clusters via <a href="http://www.hipchat.com" target="_blank" rel="noopener">HipChat</a> so that we could troubleshoot easily and without having to log into our VPN. We already use <a href="http://hubot.github.com" target="_blank" rel="noopener">Hubot</a> as part of our systems workflow, so it made sense to be able to interact with ElasticSearch with it. </p>
<h3 id="Setting-a-cluster-alias"><a href="#Setting-a-cluster-alias" class="headerlink" title="Setting a cluster alias"></a>Setting a cluster alias</h3><p>When a pager wakes me at 3am, I really do not want to have to try and type the cluster URL into my mobile hipchat client. So the first thing that was added to the script was the ability to give a cluster an alias.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch add alias my-test-alias http://my-cluster.com:9200</span><br></pre></td></tr></table></figure>
<p><img src="/images/posts/elasticsearch-add-alias.png" alt="add-alias"></p>
<p>This allows us to use that alias for all commands going forward. Please note that you can remove and query aliases as well:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch show aliases</span><br></pre></td></tr></table></figure>
<p><img src="/images/posts/elasticsearch-show-aliases.png" alt="show-alias"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch clear alias my-test-alias</span><br></pre></td></tr></table></figure>
<p><img src="/images/posts/elasticsearch-clear-alias.png" alt="clear-alias"></p>
<h3 id="Using-the-ElasticSearch-Cat-API"><a href="#Using-the-ElasticSearch-Cat-API" class="headerlink" title="Using the ElasticSearch Cat API"></a>Using the ElasticSearch Cat API</h3><p>A lot of what we do with ElasticSearch can be done via the <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cat.html" target="_blank" rel="noopener">cat</a> API. This has proved extremely useful to get node status, cluster health and index status. </p>
<h4 id="Cat-Health"><a href="#Cat-Health" class="headerlink" title="Cat Health"></a>Cat Health</h4><p>As documented <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cat-health.html#cat-health" target="_blank" rel="noopener">here</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch cluster health my-test-alias</span><br></pre></td></tr></table></figure>
<h4 id="Cat-Nodes"><a href="#Cat-Nodes" class="headerlink" title="Cat Nodes"></a>Cat Nodes</h4><p>As documented <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cat-nodes.html" target="_blank" rel="noopener">here</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch cat nodes my-test-alias</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">#### Cat Indices </span><br><span class="line">As documented [here](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cat-indices.html)</span><br></pre></td></tr></table></figure>
<p>elasticsearch cat indexes my-test-alias<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Cat Allocation</span><br><span class="line">As documented [here]()</span><br></pre></td></tr></table></figure></p>
<p>elasticsearch cat allocation my-test-alias<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Getting the Cluster Settings</span><br><span class="line"></span><br><span class="line">Sometimes when we are rebalancing shards or recycling nodes, we want to be able to control the cluster settings. By using the cluster settings API, can have some insight into the settings currently set on the cluster:</span><br></pre></td></tr></table></figure></p>
<p>elasticsearch cluster settings my-test-alias<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">More information about the cluster settings API can be found [here](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-update-settings.html#cluster-settings)</span><br><span class="line"></span><br><span class="line">### Getting the Settings for an Index</span><br><span class="line"></span><br><span class="line">Should we want to start to understand the actual settings that are attributed to an index, we can use the Cat Indices settings API. More information can be found [here](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/indices-get-settings.html)</span><br></pre></td></tr></table></figure></p>
<p>elasticsearch index settings my-test-alias my-index-name-2014-11-07<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Clearing the cluster Cache</span><br><span class="line"></span><br><span class="line">The last piece of the puzzle we are able to do, is to clear the cache of the ElasticSearch cluster. This can be done as follows:</span><br></pre></td></tr></table></figure></p>
<p>hubot elasticsearch clear cache my-test-alias<br><code>`</code></p>
<h3 id="Where-can-I-find-the-code"><a href="#Where-can-I-find-the-code" class="headerlink" title="Where can I find the code?"></a>Where can I find the code?</h3><p>The code is available on <a href="https://github.com/stack72/hubot-elasticsearch" target="_blank" rel="noopener">github</a> or also as an <a href="https://www.npmjs.org/package/hubot-elasticsearch" target="_blank" rel="noopener">NPM package</a>. Please feel free to send PRs or create issues on our repository. All feedback is useful.</p>
</article><ul class="pager blog-pager"><li class="previous"><a href="/blog/2014/11/26/hobknob-v2-dot-0-a-new-dimension/" data-toggle="tooltip" data-placement="top" title="Hobknob v2.0: A new dimension">← Previous Post</a></li><li class="next"><a href="/blog/2014/10/31/coach-dont-rescue/" data-toggle="tooltip" data-placement="top" title="Coach don't rescue">Next Post →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="https://github.com/opentable" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="https://twitter.com/opentabletechuk" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="https://www.linkedin.com/company/12181" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li><li><a href="http://stackoverflow.com/jobs/companies/opentable" title="StackOverflow"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-stack-overflow"></i></span></a></li></ul><p class="copyright text-muted">© OpenTable • 2022 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="/js/jquery-1.11.2.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-2621903-16', 'auto');
ga('send', 'pageview');</script></body></html>